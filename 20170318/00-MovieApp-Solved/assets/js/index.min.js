function loadYearsTemplate() { var e = $("#years"); e.empty(), years.forEach(function (t) { var a = $templates.filter("#tmpl-year").html(), i = $(a); e.append(i), i.text(t) }) } function loadMovieResultsTemplate(e) { var t = $templates.filter("#tmpl-movie-results").html(), a = $(t); $partialViewPlaceholder.empty().append(a), e.Search.forEach(function (e) { var t = a.find("#tmpl-movie-result").html(), i = $(t); a.append(i), i.find(".movie-title").text(e.Title), i.find(".movie-year").text(e.Year), i.find(".movie-result").attr("imdb-id", e.imdbID), "N/A" !== e.Poster && i.find("img").attr("src", e.Poster) }) } function loadMovieDetailsTemplate(e) { var t = $templates.filter("#tmpl-movie-details").html(), a = $(t); $partialViewPlaceholder.empty().append(a), a.find(".page-header span").text(e.Title), a.find(".page-header small").text(e.Genre), a.find(".movie-plot").text(e.Plot), "N/A" !== e.Poster && a.find("img").attr("src", e.Poster); var i = e.Actors.split(", "); i.forEach(function (e) { var t = a.find("#tmpl-actor").html(), i = $(t); a.find(".movie-actors").append(i), i.text(e) }) } function search() { var e = $("#search-box input").val(), t = $("#years a.active").text(); e && $.ajax({ url: apiUrl, data: { s: e, y: t } }).done(loadMovieResultsTemplate) } function searchById(e) { $.ajax({ url: apiUrl, data: { i: e } }).done(loadMovieDetailsTemplate) } var years = [2017, 2016, 2015], apiUrl = "https://www.omdbapi.com/", $templates = $("template"), $partialViewPlaceholder = $("#partial-view"); loadYearsTemplate(), $(document).on("click", "#year-box .command", function () { var e = $("#year-box input"); years.push(e.val()), loadYearsTemplate(), e.val("") }), $(document).on("click", "#search-box .command", search), $(document).on("click", "#years a", function () { var e = $(this); $("#years a").removeClass("active"), e.addClass("active"), search() }), $(document).on("click", ".movie-result", function () { var e = $(this).attr("imdb-id"); searchById(e) });